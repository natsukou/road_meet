(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8772:function(e,t,s){Promise.resolve().then(s.bind(s,7736))},7736:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var r=s(3827),a=s(4090),n=s(7907),l=s(8792),i=s(5790);function d(){let e=(0,n.useRouter)(),[t,s]=(0,a.useState)(null),[d,c]=(0,a.useState)([]),[o,x]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[h,g]=(0,a.useState)("");return((0,a.useEffect)(()=>{let t=(0,i.PR)();if(!t){e.push("/login");return}s(t),c((0,i.Ak)().filter(e=>e.creatorPhone===t.phone||e.partnerPhone===t.phone))},[e]),t)?(0,r.jsxs)("div",{className:"min-h-screen bg-light",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto px-4 py-4 flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-dark",children:"RoadMeet"}),(0,r.jsx)("button",{onClick:()=>{localStorage.removeItem("roadmeet_user"),e.push("/login")},className:"text-sm text-gray hover:text-primary",children:"退出"})]})}),(0,r.jsxs)("main",{className:"max-w-md mx-auto px-4 py-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("p",{className:"text-gray",children:"欢迎回来"}),(0,r.jsx)("p",{className:"text-lg font-medium text-dark",children:t.phone})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[(0,r.jsxs)("button",{onClick:()=>x(!0),className:"bg-primary text-white p-6 rounded-2xl text-center hover:bg-blue-600 transition-colors",children:[(0,r.jsx)("div",{className:"text-3xl mb-2",children:"+"}),(0,r.jsx)("div",{className:"font-medium",children:"创建见面"})]}),(0,r.jsxs)("button",{onClick:()=>u(!0),className:"bg-secondary text-white p-6 rounded-2xl text-center hover:bg-green-600 transition-colors",children:[(0,r.jsx)("div",{className:"text-3xl mb-2",children:"#"}),(0,r.jsx)("div",{className:"font-medium",children:"加入见面"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-dark mb-4",children:"我的见面"}),0===d.length?(0,r.jsxs)("div",{className:"text-center py-12 bg-white rounded-2xl",children:[(0,r.jsx)("p",{className:"text-gray",children:"暂无见面任务"}),(0,r.jsx)("p",{className:"text-sm text-gray mt-1",children:"创建或加入一个见面吧"})]}):(0,r.jsx)("div",{className:"space-y-3",children:d.map(e=>(0,r.jsx)(l.default,{href:"/task/".concat(e.id),className:"block bg-white p-4 rounded-2xl shadow-sm hover:shadow-md transition-shadow",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-lg font-bold text-primary",children:["#",e.code]}),(0,r.jsxs)("div",{className:"text-sm text-gray mt-1",children:["pending"===e.status&&"等待匹配","matched"===e.status&&"匹配成功","ongoing"===e.status&&"见面中","completed"===e.status&&"已完成","cancelled"===e.status&&"已取消"]})]}),(0,r.jsx)("div",{className:"text-xs text-gray",children:new Date(e.createdAt).toLocaleDateString()})]})},e.id))})]})]}),o&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-dark mb-4",children:"创建见面任务"}),(0,r.jsx)("p",{className:"text-gray text-sm mb-6",children:"创建后将生成唯一的6位16进制代号，分享给对方即可匹配见面。"}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>x(!1),className:"flex-1 py-3 border border-gray-200 rounded-xl text-dark hover:bg-gray-50",children:"取消"}),(0,r.jsx)("button",{onClick:()=>{if(!t)return;let s={id:"task_".concat(Date.now()),code:(0,i.FZ)(),creatorPhone:t.phone,status:"pending",editCount:{creator:0,partner:0},maxEdits:6,createdAt:new Date().toISOString()};(0,i.F9)(s),x(!1),e.push("/task/".concat(s.id))},className:"flex-1 py-3 bg-primary text-white rounded-xl hover:bg-blue-600",children:"创建"})]})]})}),m&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-dark mb-4",children:"加入见面任务"}),(0,r.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value.toUpperCase()),placeholder:"输入6位代号（如：A3F9B2）",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary mb-6",maxLength:6}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>u(!1),className:"flex-1 py-3 border border-gray-200 rounded-xl text-dark hover:bg-gray-50",children:"取消"}),(0,r.jsx)("button",{onClick:()=>{if(!h||!t)return;let s=(0,i.Ak)().find(e=>e.code===h.toUpperCase());if(!s){alert("未找到该见面任务，请检查代号");return}if(s.creatorPhone===t.phone){alert("不能加入自己创建的任务");return}if(s.partnerPhone){alert("该任务已被其他人加入");return}s.partnerPhone=t.phone,s.status="matched",(0,i.F9)(s),u(!1),e.push("/task/".concat(s.id))},className:"flex-1 py-3 bg-secondary text-white rounded-xl hover:bg-green-600",children:"加入"})]})]})})]}):null}},5790:function(e,t,s){"use strict";s.d(t,{Ak:function(){return n},F9:function(){return l},FZ:function(){return d},PR:function(){return a},mZ:function(){return c},yW:function(){return i}});let r={USER:"roadmeet_user",TASKS:"roadmeet_tasks"},a=()=>{let e=localStorage.getItem(r.USER);return e?JSON.parse(e):null},n=()=>{let e=localStorage.getItem(r.TASKS);return e?JSON.parse(e):[]},l=e=>{let t=n(),s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.push(e),localStorage.setItem(r.TASKS,JSON.stringify(t))},i=e=>n().find(t=>t.id===e),d=()=>Math.floor(16777215*Math.random()).toString(16).toUpperCase().padStart(6,"0"),c=(e,t)=>({lat:(e.lat+t.lat)/2,lng:(e.lng+t.lng)/2})}},function(e){e.O(0,[901,971,69,744],function(){return e(e.s=8772)}),_N_E=e.O()}]);