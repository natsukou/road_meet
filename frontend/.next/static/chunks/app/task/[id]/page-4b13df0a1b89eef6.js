(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[985],{390:function(e,t,s){Promise.resolve().then(s.bind(s,9946))},9946:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(3827),r=s(4090),n=s(7907),l=s(8792),c=s(5790);function i(){let e=(0,n.useRouter)(),t=(0,n.useParams)(),[s,i]=(0,r.useState)(null),[d,o]=(0,r.useState)(null),[x,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[g,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let s=(0,c.PR)();if(!s){e.push("/login");return}i(s);let a=t.id,r=(0,c.yW)(a);if(!r){e.push("/dashboard");return}o(r),u(!1)},[t.id,e]),null==d||d.creatorPhone,null==s||s.phone;let b=(null==d?void 0:d.creatorLocation)&&(null==d?void 0:d.partnerLocation);return x||!d?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-light",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray",children:"加载中..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-light",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto px-4 py-4 flex items-center gap-4",children:[(0,a.jsx)(l.default,{href:"/dashboard",className:"text-gray hover:text-dark",children:"← 返回"}),(0,a.jsx)("h1",{className:"text-lg font-bold text-dark",children:"见面详情"})]})}),(0,a.jsxs)("main",{className:"max-w-md mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 text-center mb-6",children:[(0,a.jsx)("p",{className:"text-gray text-sm mb-2",children:"见面代号"}),(0,a.jsxs)("div",{className:"text-4xl font-bold text-primary tracking-wider",children:["#",d.code]}),(0,a.jsx)("div",{className:"mt-4 flex justify-center gap-2",children:(0,a.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs ".concat("pending"===d.status?"bg-yellow-100 text-yellow-700":"matched"===d.status?"bg-blue-100 text-blue-700":"ongoing"===d.status?"bg-green-100 text-green-700":"completed"===d.status?"bg-gray-100 text-gray-700":"bg-red-100 text-red-700"),children:["pending"===d.status&&"等待匹配","matched"===d.status&&"匹配成功","ongoing"===d.status&&"见面中","completed"===d.status&&"已完成","cancelled"===d.status&&"已取消"]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 mb-6",children:[(0,a.jsx)("h3",{className:"font-medium text-dark mb-4",children:"位置状态"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-gray",children:"创建者位置"}),(0,a.jsx)("span",{className:d.creatorLocation?"text-secondary":"text-gray",children:d.creatorLocation?"✓ 已共享":"等待中..."})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-gray",children:"对方位置"}),(0,a.jsx)("span",{className:d.partnerLocation?"text-secondary":"text-gray",children:d.partnerLocation?"✓ 已共享":"等待中..."})]})]}),!m&&"cancelled"!==d.status&&"completed"!==d.status&&(0,a.jsx)("button",{onClick:()=>{if(!navigator.geolocation){alert("您的浏览器不支持地理定位");return}navigator.geolocation.getCurrentPosition(e=>{let t={lat:e.coords.latitude,lng:e.coords.longitude};if(h(t),d&&s){let e={...d};d.creatorPhone===s.phone?e.creatorLocation=t:e.partnerLocation=t,e.creatorLocation&&e.partnerLocation&&(e.status="ongoing"),(0,c.F9)(e),o(e)}},e=>{alert("无法获取位置信息，请检查权限设置")})},className:"w-full mt-4 py-3 bg-primary text-white rounded-xl hover:bg-blue-600 transition-colors",children:"共享我的位置"}),m&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-xl",children:(0,a.jsxs)("p",{className:"text-sm text-primary",children:["您的位置已共享",(0,a.jsx)("br",{}),"纬度: ",m.lat.toFixed(6),(0,a.jsx)("br",{}),"经度: ",m.lng.toFixed(6)]})})]}),b&&(0,a.jsx)(l.default,{href:"/map/".concat(d.id),className:"block w-full py-4 bg-secondary text-white rounded-xl text-center font-medium hover:bg-green-600 transition-colors mb-4",children:"查看地图和推荐地点 →"}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 mb-6",children:[(0,a.jsx)("h3",{className:"font-medium text-dark mb-4",children:"编辑次数"}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-gray",children:["创建者: ",d.editCount.creator,"/6"]}),(0,a.jsxs)("span",{className:"text-gray",children:["对方: ",d.editCount.partner,"/6"]})]})]}),"cancelled"!==d.status&&"completed"!==d.status&&(0,a.jsx)("button",{onClick:()=>p(!0),className:"w-full py-3 border border-red-200 text-red-500 rounded-xl hover:bg-red-50 transition-colors",children:"取消见面"})]}),g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-dark mb-4",children:"确认取消见面？"}),(0,a.jsx)("p",{className:"text-gray text-sm mb-6",children:"取消后对方将收到通知，双方确认后任务将被删除。"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>p(!1),className:"flex-1 py-3 border border-gray-200 rounded-xl text-dark hover:bg-gray-50",children:"再想想"}),(0,a.jsx)("button",{onClick:()=>{if(!d||!s)return;let e={...d};e.status="cancelled",e.cancelledBy=s.phone,(0,c.F9)(e),o(e),p(!1)},className:"flex-1 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600",children:"确认取消"})]})]})})]})}},5790:function(e,t,s){"use strict";s.d(t,{Ak:function(){return n},F9:function(){return l},FZ:function(){return i},PR:function(){return r},mZ:function(){return d},yW:function(){return c}});let a={USER:"roadmeet_user",TASKS:"roadmeet_tasks"},r=()=>{let e=localStorage.getItem(a.USER);return e?JSON.parse(e):null},n=()=>{let e=localStorage.getItem(a.TASKS);return e?JSON.parse(e):[]},l=e=>{let t=n(),s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.push(e),localStorage.setItem(a.TASKS,JSON.stringify(t))},c=e=>n().find(t=>t.id===e),i=()=>Math.floor(16777215*Math.random()).toString(16).toUpperCase().padStart(6,"0"),d=(e,t)=>({lat:(e.lat+t.lat)/2,lng:(e.lng+t.lng)/2})}},function(e){e.O(0,[901,971,69,744],function(){return e(e.s=390)}),_N_E=e.O()}]);